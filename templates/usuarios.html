{% extends "base.html" %}

{% block title %}Gesti√≥n de Usuarios{% endblock %}

{% block content %}
<h1>Gesti√≥n de Usuarios</h1>

<h2>Crear / Editar Usuario</h2>

<form method="post"
      action="{{ form_action or '/usuarios/crear' }}"
      enctype="multipart/form-data">
    <div>
        <label for="idUsuario">ID (solo para edici√≥n):</label>
        <input type="number" id="idUsuario" name="idUsuario"
               value="{{ usuario.idUsuario if usuario else '' }}" readonly>
    </div>

    <div>
        <label for="nombre">Nombre*</label>
        <input type="text" id="nombre" name="nombre"
               value="{{ usuario.nombre if usuario else '' }}" required>
    </div>

    <div>
        <label for="ingresos">Ingresos*</label>
        <input type="number" id="ingresos" name="ingresos"
               value="{{ usuario.ingresos if usuario else '' }}"
               min="0" step="0.01" required>
    </div>

    <div>
        <label for="gastos">Gastos*</label>
        <input type="number" id="gastos" name="gastos"
               value="{{ usuario.gastos if usuario else '' }}"
               min="0" step="0.01" required>
    </div>

    <div>
        <label for="correo">Correo*</label>
        <input type="email" id="correo" name="correo"
               value="{{ usuario.correo if usuario else '' }}" required>
    </div>

    <div>
        <label for="telefono">Tel√©fono*</label>
        <input type="tel" id="telefono" name="telefono"
               value="{{ usuario.telefono if usuario else '' }}" required>
    </div>

    <div>
        <label for="cedula">C√©dula (PDF o JPG)</label>
        <input type="file" id="cedula" name="cedula" accept=".pdf,.jpg,.jpeg">
        {% if usuario and usuario.cedula %}
            <p>
                Archivo actual:
                {# mostramos solo el nombre del archivo #}
                {% set partes = usuario.cedula.split('/') %}
                {{ partes[-1] }}
                -
                <a href="/{{ usuario.cedula }}" target="_blank">Ver archivo</a>
            </p>
        {% endif %}
    </div>

    <div style="margin-top: 1rem;">
        <button type="submit">Guardar</button>
        <button type="reset">Limpiar</button>
    </div>
</form>

<hr>

<h2>Lista de Usuarios</h2>
<table border="1" cellpadding="5" cellspacing="0" style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="background-color: #f2f2f2;">
            <th>ID</th>
            <th>Nombre</th>
            <th>Ingresos</th>
            <th>Gastos</th>
            <th>Correo</th>
            <th>Documento (C√©dula)</th> <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
    {% for u in usuarios %}
        <tr>
            <td>{{ u.idUsuario }}</td>
            <td>{{ u.nombre }}</td>
            <td>{{ u.ingresos }}</td>
            <td>{{ u.gastos }}</td>
            <td>{{ u.correo }}</td>
            
            <td style="text-align: center;">
                {% if u.cedula %}
                    {% set nombre_archivo = u.cedula.split('/')[-1] %}
                    
                    <div style="font-size: 0.9em; margin-bottom: 5px;">
                        <strong>{{ nombre_archivo }}</strong>
                    </div>

                    <a href="/{{ u.cedula }}" target="_blank" 
                       style="background-color: #007bff; color: white; padding: 4px 8px; text-decoration: none; border-radius: 4px; font-size: 0.8em;">
                       üëÅÔ∏è Ver Documento
                    </a>
                {% else %}
                    <span style="color: #999;">Sin archivo</span>
                {% endif %}
            </td>

            <td>
                <a href="/ui/usuarios/{{ u.idUsuario }}" style="color: #28a745; font-weight: bold;">Editar</a>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}
{% extends "base.html" %}
{% block title %}Categorías{% endblock %}

{% block content %}
<h1>Categorías</h1>

<h2>{{ titulo_form or "Gestionar Categoría" }}</h2>

<form method="post" action="{{ form_action or '/categorias/crear' }}">
    {% if categoria_editar %}
        <input type="hidden" name="idCategoria" value="{{ categoria_editar.idCategoria }}">
    {% endif %}

    <div class="form-row">
        <label for="nombre">Nombre de la categoría *</label>
        <input type="text"
               id="nombre"
               name="nombre"
               required
               maxlength="100"
               value="{{ categoria_editar.nombre if categoria_editar else '' }}">
    </div>

    <div class="form-row">
        <label for="descripcion">Descripción *</label>
        <textarea id="descripcion"
                  name="descripcion"
                  rows="3"
                  required>{{ categoria_editar.descripcion if categoria_editar else '' }}</textarea>
    </div>

    <div class="form-row">
        <label for="credito_id">Crédito asociado *</label>
        <select id="credito_id" name="credito_id" required>
            <option value="">-- Seleccione un crédito --</option>
            {% for cr in creditos %}
            {% set selected_credito = credito_id_actual if categoria_editar else None %}
            <option value="{{ cr.idCredito }}"
                {% if selected_credito and selected_credito == cr.idCredito %}selected{% endif %}>
                {{ cr.idCredito }} - {{ cr.tipo }} - {{ cr.monto }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="form-actions">
        <button type="submit">
            {% if categoria_editar %}Actualizar{% else %}Guardar{% endif %}
        </button>
        <a href="/ui/categorias">Limpiar / Nuevo</a>
    </div>
</form>

<hr>

<h2>Lista de Categorías</h2>
<table>
    <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Descripción</th>
        <th>Crédito asociado</th>
        <th>Acciones</th>
    </tr>
    {% for c in categorias %}
    <tr>
        <td>{{ c.idCategoria }}</td>
        <td>{{ c.nombre }}</td>
        <td>{{ c.descripcion }}</td>
        <td>
            {% set cid = cat_creditos.get(c.idCategoria) %}
            {% if cid %}
                {{ cid }}
            {% else %}
                Sin asignar
            {% endif %}
        </td>
        <td>
            <a href="/ui/categorias/{{ c.idCategoria }}">Editar</a>
        </td>
    </tr>
    {% endfor %}
</table>
{% endblock %}
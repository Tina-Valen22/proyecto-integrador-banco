{% extends "base.html" %}
{% block title %}Créditos{% endblock %}

{% block content %}
<h1>Créditos</h1>

<h2>{{ titulo_form or "Gestionar Crédito" }}</h2>

<form method="post" action="{{ form_action or '/creditos/crear' }}">
    {% if credito_editar %}
        <input type="hidden" name="idCredito" value="{{ credito_editar.idCredito }}">
    {% endif %}

    <div class="form-row">
        <label for="usuario_id">Usuario solicitante *</label>
        <select id="usuario_id" name="usuario_id" required>
            <option value="">-- Seleccione un usuario --</option>
            {% for u in usuarios %}
            <option value="{{ u.idUsuario }}"
                {% if credito_editar and credito_editar.usuario_id == u.idUsuario %}selected{% endif %}>
                {{ u.idUsuario }} - {{ u.nombre }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="form-row">
        <label for="monto">Monto solicitado (COP) *</label>
        <input type="number"
               id="monto"
               name="monto"
               required
               min="100000"
               step="0.01"
               value="{{ credito_editar.monto if credito_editar else '' }}">
    </div>

    <div class="form-row">
        <label for="plazo">Plazo (meses) *</label>
        <input type="number"
               id="plazo"
               name="plazo"
               required
               min="1"
               step="1"
               value="{{ credito_editar.plazo if credito_editar else '' }}">
    </div>

    <div class="form-row">
        <label for="tipo">Tipo de crédito *</label>
        <input type="text"
               id="tipo"
               name="tipo"
               required
               maxlength="100"
               placeholder="Hipotecario, consumo, vehículo..."
               value="{{ credito_editar.tipo if credito_editar else '' }}">
    </div>

    <div class="form-row">
        <label for="descripcion">Descripción de la solicitud *</label>
        <textarea id="descripcion"
                  name="descripcion"
                  rows="3"
                  required>{{ credito_editar.descripcion if credito_editar else '' }}</textarea>
    </div>

    <div class="form-actions">
        <button type="submit">
            {% if credito_editar %}Actualizar{% else %}Guardar{% endif %}
        </button>
        <a href="/ui/creditos">Limpiar / Nuevo</a>
    </div>
</form>

<hr>

<h2>Lista de Créditos</h2>
<table>
    <tr>
        <th>ID</th>
        <th>Usuario</th>
        <th>Monto</th>
        <th>Plazo</th>
        <th>Tipo</th>
        <th>Descripción</th>
        <th>Acciones</th>
    </tr>
    {% for c in creditos %}
    <tr>
        <td>{{ c.idCredito }}</td>
        <td>{{ c.usuario_id }}</td>
        <td>{{ c.monto }}</td>
        <td>{{ c.plazo }}</td>
        <td>{{ c.tipo }}</td>
        <td>{{ c.descripcion }}</td>
        <td>
            <a href="/ui/creditos/{{ c.idCredito }}">Editar</a>
        </td>
    </tr>
    {% endfor %}
</table>
{% endblock %}